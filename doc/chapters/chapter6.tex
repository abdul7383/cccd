\chapter{Evaluation\label{cha:chapter6}}


\section{Test Environment\label{sec:eval_te_en}}
Normally in case of a concrete application there is no need to show in details how to install and configure the application but the output of this thesis is a framework which consist of many components. In order to make it easier for developers who need to deploy this framework, this section provide a details information on how to install and configure each component. Each component will be installed on a Linux machine running in the \ac{AWS} platform. Each of these machines has 7 GB RAM and 20 \ac{EC2} Compute Units (8 virtual cores with 2.5 \ac{EC2} Compute Units each) and running Ubuntu 12.04. The name of this machine within \ac{AWS} platform is \textit{High-CPU Extra Large Instance/c1.xlarge}. In order to have these machines in the same private network, these machines are created within the Amazon \ac{VPC}. 

Amazon \ac{VPC} enables provisioning of a logically isolated section of the AWS Cloud where one can launch AWS resources in a virtual network. One have complete control over the virtual networking environment, including selection of the IP address range, creation of subnets, and configuration of route tables.

Table \ref{tbl:ap_addresses} shows the IP address of each component. Thereby only the components, the app management and the content distribution have a private as well as a public IP address because these components as seen in figure \ref{fig:arch_overview} are the only components that the developer can interact with. 

\begin{table}[htb]
\begin{tabular}{|c|c|c|}
\hline 
Name & IP address \\ 
\hline 
App Management & $\begin{array}{l} \textbf{public:107.23.121.185} \\ \textbf{private:10.0.0.130}  \end{array}$ \\ 
\hline 
Repository & \textbf{10.0.0.135} \\ 
\hline 
Search Engine & \textbf{10.0.0.136} \\ 
\hline
Message Broker & \textbf{10.0.0.137} \\ 
\hline
Content Adaptation & \textbf{10.0.0.138} \\ 
\hline
Content Distribution & $\begin{array}{l} \textbf{public:107.23.180.173} \\ \textbf{private:10.0.0.139}  \end{array}$ \\ 
\hline
\end{tabular} 
\caption{IP address of each component}
\label{tbl:ap_addresses}
\end{table} 

The source code along with the documentation of the entire framework can be obtained from the following GitHub link: \url{https://github.com/abdul7383/cccd}.

\subsection{App Management\label{sec:eval_te_en_app}}
The source code of the app management component can be obtained with following command:
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
git clone git://github.com/abdul7383/cccd.git
\end{minted}
\end{code}

In order to deploy the app management component, one needs first to install and configure the following software:

\begin{itemize}
\item{\textbf{\ac{JDK} 7:}} Installing  \ac{JDK} 7 on Ubuntu is just easy as typing the following command.% in listing \ref{lst:jdk_installation}.
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo apt-get install openjdk-7-jdk
\end{minted}
%\caption{Installing \ac{JDK} 7 on Ubuntu}
%\label{lst:jdk_installation}
\end{code}

\item{\textbf{Maven 3:}}  After downloading and extracting Maven, one needs to add the \textit{bin} directory of Maven to the Linux PATH variable. Further more one need to add the following tag within the \textit{servers} tag to the setting file of Maven \textit{apache-maven-3.0.5/conf/settings.xml}.
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{xml}
<server>
	<id>tomcat7</id>
	<username>tomcat</username>
	<password>tomcat</password>
</server>
\end{minted}
\end{code}

\item{\textbf{Tomcat 7:}} After downloading and extracting the Apache Tomcat, one need to modify the file \textit{apache-tomcat-7.0.37/conf/tomcat-users.xml} as follow in order to enable Maven to directly deploy the project into it. 
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{xml}
<?xml version='1.0' encoding='utf-8'?>
<tomcat-users>
	<role rolename="manager-script"/>
	<user username="tomcat" password="tomcat" roles="manager-script"/>
</tomcat-users>
\end{minted}
\end{code}

To start the Tomcat server from any location in Linux one also needs to add the \textit{bin} directory to the Linux PATH. The following examples updates the PATH variable for Maven and Tomcat assuming that the home directory of the user is \textit{ubuntu} and both Maven and Tomcat have been extracted to the home directory:
TODO TODO delete backslash
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
export PATH=/home/ubuntu/apache-maven-3.0.5/bin:/home/ubuntu/apache-tomcat-7.0.37/bin:\$PATH
\end{minted}
\end{code}

This sets the PATH variable only for the current Linux session but in order to have this configuration valid also for each new Linux sessions, one need to add the export line above to the end of the file \textit{/home/ubuntu/.bashrc} .

Furthermore the SSL support of Tomcat needs to be enabled and this is shown in details in the official documentation of Apache Tomcat here \cite{tomcat_ssl}.

\end{itemize}

After having all installed and configured as described above, the Tomcat server can be started with the following command:
\textit{ubuntu} and both Maven and Tomcat have been extracted to the home directory:
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
catalina.sh start
\end{minted}
\end{code} 

All debug messages of the Tomcat server can be seen in the log file \textit{apache-tomcat-7.0.37/logs/catalina.out}. 

Before deploying the app management component, one needs first to install and start all other components and then to update the IP addresses of these components in the \textit{pom.xml} file of the project as described in \ref{sec:impl_repo}, \ref{sec:impl_se_en} and \ref{sec:impl_mb}. The following command will then deploy the app management component to the Tomcat server:
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd cccd/cccdAppManagement/
mvn tomcat:deploy
\end{minted}
\end{code}

It will take sometime for the first run as Maven will download and compile all needed libraries and classes.

At this point there is no user or admin for the framework and to add the first admin to the framework, one need to run the following Maven command:

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
mvn exec:java -Dexec.mainClass="de.fhg.fokus.ngni.cccd.services.AddAdmin"
\end{minted}
\end{code}

This command will add the admin user information in a new collection called \textit{user} within a new database called \textit{users}.  After having at least one admin then the RESTful framework user management Interface \textit{/users} described in \ref{sec:des_rest_api} can be used for adding new admins or users.

\subsection{Repository/Media Store\label{sec:eval_te_en_mongo}}
The installation of MongoDB on Ubuntu is described in listing \ref{lst:mongdb_installation}, see this reference for more details \cite{MongoDb:installation}. Thereby the second command must be run in one line.  
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
echo "deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart 
	dist 10gen" | sudo tee /etc/apt/sources.list.d/10gen.list
sudo apt-get update
sudo apt-get install mongodb-10gen
\end{minted}
\caption{Installing MongoDB on Ubuntu}
\label{lst:mongdb_installation}
\end{code}

Deploying a replication set of three MongoDB instances in order to provide a sufficient capacity for many distributed read operations can be seen in the official documentation of MongoDB here \cite{mongodb_replica_set}.

%In order to add the first admin for the framework, one need to create a database called \textit{users} and then create a new collection called \textit{user}
\subsection{Search Engine\label{sec:eval_te_se}}
After downloading  and extracting the version 0.20.4 of Elasticsearch, it can be started using:
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
bin/elasticsearch
\end{minted}
\end{code}

ElasticSearch is built using Java, and requires at least Java 6 in order to run. Therefore one needs to install the \ac{JDK} as described in subsection \ref{sec:eval_te_en_app}.

Under Unix system, the command will start the process in the background. To run it in the foreground, one need to add the -f switch to it:
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
bin/elasticsearch -f
\end{minted}
\end{code}

The most important setting for the script is the -Xmx to control the maximum allowed memory for the process, and -Xms to control the minimum allocated memory for the process. The following command starts Elasticsearch in the foreground and sets the max/min memory to 4GB and stores the index in the memory. 
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
bin/elasticsearch -f  -Xmx4g -Xms4g -Des.index.storage.type=memory
\end{minted}
\end{code}

Further configuration parameters can be seen in the setup documentation of Elasticsearch here \cite{elastic_setup}.

\subsection{Message Broker\label{sec:eval_te_mb}}
The installation of the last release of RabbitMQ is shown in the following steps:

\begin{itemize}

\item One needs to add the following line to the file \textit{/etc/apt/sources.list}:

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
deb http://www.rabbitmq.com/debian/ testing main
\end{minted}
\end{code}

\item To avoid warnings about unsigned packages, add the public key of RabbitMQ to the trusted key list using apt-key:

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
wget http://www.rabbitmq.com/rabbitmq-signing-key-public.asc
sudo apt-key add rabbitmq-signing-key-public.asc
\end{minted}
\end{code}

\item And then install the package as usual, for instance:

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo apt-get update
sudo apt-get install rabbitmq-server
\end{minted}
\end{code}

\end{itemize} 

To start or stop the server or check its status, etc., one can use the script rabbitmqctl as an administrator. 
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo rabbitmqctl status
sudo rabbitmqctl stop
sudo rabbitmqctl start
\end{minted}
\end{code}

\subsection{Content Adaptation\label{sec:eval_te_ca}}
As described in \ref{sec:des_ar_ov}, this components consist internally of the media encoder, the media segmenter and a python script called \textit{cccdCA.py}. How to install and configure these components is described below.  

The following steps are for installing FFmpeg (media encoder) along with some needed libraries. Some of the libraries are in the Ubuntu multiverse repository. So, one need to edit \textit{/etc/apt/sources.list} to include the multiverse repository as well.

\begin{itemize}
\item First of all, the following command install some of the dependencies needed by FFmpeg

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo apt-get update
sudo apt-get install autoconf automake build-essential checkinstall \
  git libass-dev libfaac-dev libgpac-dev libmp3lame-dev \
  libopencore-amrnb-dev libopencore-amrwb-dev librtmp-dev libspeex-dev \
  libtheora-dev libtool libvorbis-dev pkg-config texi2html zlib1g-dev
\end{minted}
\end{code}

\item{\textbf{Yasm}:} Yasm is an assembler and is recommended for x264 and FFmpeg

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd
wget http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz
tar xzvf yasm-1.2.0.tar.gz
cd yasm-1.2.0
./configure
make
sudo checkinstall --pkgname=yasm --pkgversion="1.2.0" \
  --backup=no --deldoc=yes --fstrans=no --default
\end{minted}
\end{code}

\item{\textbf{x264}:} H.264 video encoder. The following commands will get the current source files, compile, and install x264.
 
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd
git clone --depth 1 git://git.videolan.org/x264.git
cd x264
./configure --enable-shared
make
sudo checkinstall --pkgname=x264 \
  --pkgversion="3:$(./version.sh | awk -F'[" ]' '/POINT/{print $4"+git"$5}')" \
  --backup=no --deldoc=yes --fstrans=no --default 
\end{minted}
\end{code}

\item{\textbf{fdk-aac:}} AAC audio encoder.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd
git clone --depth 1 git://github.com/mstorsjo/fdk-aac.git
cd fdk-aac
autoreconf -fiv
./configure --disable-shared
make
sudo checkinstall --pkgname=fdk-aac --pkgversion="$(date +%Y%m%d%H%M)-git" \
 --backup=no --deldoc=yes --fstrans=no --default
\end{minted}
\end{code}

\item{\textbf{libvpx:}} VP8 video encoder and decoder.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd
git clone --depth 1 http://git.chromium.org/webm/libvpx.git
cd libvpx
./configure --disable-examples --disable-unit-tests
make
sudo checkinstall --pkgname=libvpx --pkgversion="1:$(date +%Y%m%d%H%M)-git" \
  --backup=no --deldoc=yes --fstrans=no --default  
\end{minted}
\end{code}

\item{\textbf{FFmpeg:}} TODO TODO delete Dolar
\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd
wget http://ffmpeg.org/releases/ffmpeg-0.9.2.tar.bz2
tar -xvvf ffmpeg-0.9.2.tar.bz2 
cd ffmpeg-0.9.2

./configure --enable-gpl --enable-libass --enable-libfaac \
  --enable-libmp3lame --enable-libopencore-amrnb --enable-libopencore-amrwb \
  --enable-libspeex --enable-librtmp --enable-libtheora --enable-libvorbis \
  --enable-libvpx --enable-libx264 --enable-nonfree --enable-version3
make
sudo checkinstall --pkgname=ffmpeg --pkgversion="0.9.2" \
  --backup=no --deldoc=yes --fstrans=no --default
sudo ldconfig $
\end{minted}
\end{code}
\end{itemize}

The following steps describes how to compile the media segmenter/distributor.

\begin{itemize}

\item The source code can be obtained with following command.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
git clone git://github.com/abdul7383/cccd.git
\end{minted}
\end{code}

\item The following command install some of the dependencies needed by the media segmenter/distributor.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
sudo apt-get install ruby rubygems
\end{minted}
\end{code}

\item For compiling the media segmenter/distributor, the following commands are needed.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd ~/cccd/cccdContentAdaption/hls
make
\end{minted}
\end{code}

\end{itemize} 

The python script \textit{cccdCA.py} and its configuration \textit{cccdCA.conf} are located in the directory \textit{~/cccd/cccdContentAdaption}. Most important configuration in \textit{ cccdCA.conf}  is the FTP transfer profile. One need to set the IP address and the user credentials of the FTP server, which is installed on the content distribution component \ref{sec:eval_te_cd}. The default configuration contains 8 encoding profiles shown below. These encoding profiles are for devices with 16x9 or 4x3 screen resolution and they are in four different streams bitrate.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
[ 'cell_16x9_150k', 'cell_16x9_240k', 'wifi_16x9_440k', 'wifi_16x9_640k' , 'cell_4x3_150k', 'cell_4x3_240k', 'wifi_4x3_440k', 'wifi_4x3_640']
\end{minted}
\end{code}

Finally to start the content adaptation component, one need simply to run the following commands.

\begin{code}
\begin{minted}[frame=single,tabsize=2,fontsize=\footnotesize]{console}
cd ~/cccd/cccdContentAdaption
./cccdCA.py
\end{minted}
\end{code}

\subsection{Content Distribution\label{sec:eval_te_cd}}
As described in \ref{sec:impl_cdn}, the content distribution component consists internally of two components, which are a python script called \textit{cccdCD.py} and the open source project NginX as a \ac{HTTP} server.
\section{Test Scenarios\label{sec:eval__te_sc}}
	\subsection{Usability\label{seq:eval_usab}}
	
	\subsection{Performance\label{seq:eval_perf}}